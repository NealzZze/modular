const cvs=document.getElementById("canvas"),ctx=cvs.getContext("2d");document.addEventListener("click",moveUp),document.getElementById("flappy-start").onclick=draw;const bird=new Image,bg=new Image,fg=new Image,pipeUp=new Image,pipeBottom=new Image;bird.src="frontend/games/flappy/img/bird.png",bg.src="frontend/games/flappy/img/bg.png",fg.src="frontend/games/flappy/img/fg.png",pipeUp.src="frontend/games/flappy/img/pipeUp.png",pipeBottom.src="frontend/games/flappy/img/pipeBottom.png";var fly=new Audio,score_audio=new Audio;fly.src="frontend/games/flappy/audio/fly.mp3",score_audio.src="frontend/games/flappy/audio/score.mp3";let xPos=10,yPos=150;const gap=150;let step,score=0;const grav=2.3;function moveUp(){yPos-=37,fly.play()}let pipe=[];pipe[0]={x:cvs.width,y:0};function draw(){ctx.drawImage(bg,0,0),ctx.drawImage(fg,0,cvs.height-fg.height),ctx.drawImage(bird,xPos,yPos);for(let a=0;a<pipe.length;a++)ctx.drawImage(pipeUp,pipe[a].x,pipe[a].y),ctx.drawImage(pipeBottom,pipe[a].x,pipe[a].y+pipeUp.height+gap),pipe[a].x--,125==pipe[a].x&&pipe.push({x:cvs.width,y:Math.floor(Math.random()*pipeUp.height)-pipeUp.height}),(xPos+bird.width>=pipe[a].x&&xPos<=pipe[a].x+pipeUp.width&&(yPos<=pipe[a].y+pipeUp.height||yPos+bird.height>=pipe[a].y+pipeUp.height+gap)||yPos+bird.height>=cvs.height-fg.height)&&gameOver(),5==pipe[a].x&&(score++,score_audio.play());yPos+=grav,ctx.fillStyle="#000",ctx.font="20px Verdana",ctx.fillText("\u0421\u0447\u0451\u0442: "+score,10,cvs.height-20),step=requestAnimationFrame(draw)}function gameOver(){cancelAnimationFrame(step),ctx.fillText("\u0414\u043B\u044F \u043D\u043E\u0432\u043E\u0439 \u043F\u043E\u043F\u044B\u0442\u043A\u0438",10,100),ctx.fillText("\u043F\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443",10,130),document.addEventListener("keydown",a=>{192===a.keyCode&&reset()})}function reset(){ctx.clearRect(0,0,288,512),xPos=10,yPos=150,score=0,pipe=[],draw(),step=requestAnimationFrame(draw),document.removeEventListener("keydown",a=>{192===a.keyCode})}document.onkeydown=function(a){let b=a.keyCode||a.charCode;32===b&&a.preventDefault()};